<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Google Cloud TTS (ì¤‘êµ­ì–´ â†’ MP3)</title>
</head>
<body>
  <h2>ì¤‘êµ­ì–´ TTS â†’ MP3 ë‹¤ìš´ë¡œë“œ</h2>

  <textarea id="text" rows="3" cols="40">å…¬å¸åŒäº‹ä¸­, å‘¨å›´å»å¤–å›½ç•™å­¦çš„åŒäº‹å¤šå—ï¼Ÿ</textarea><br><br>

  <!-- ì†ë„ ì¡°ì ˆ -->
  <label for="speed">ì†ë„: </label>
  <input type="range" id="speed" min="0.5" max="2.0" step="0.1" value="1">
  <span id="speedVal">1.0</span><br><br>

  <!-- ëª©ì†Œë¦¬ ì„ íƒ -->
  <label for="voice">ëª©ì†Œë¦¬ ì„ íƒ: </label>
  <select id="voice">
    <option value="cmn-CN-Wavenet-A">ì—¬ì„± - Wavenet A</option>
    <option value="cmn-CN-Wavenet-B">ë‚¨ì„± - Wavenet B</option>
    <option value="cmn-CN-Wavenet-C">ì—¬ì„± - Wavenet C</option>
    <option value="cmn-CN-Wavenet-D">ë‚¨ì„± - Wavenet D</option>
    <option value="cmn-CN-Standard-A">ì—¬ì„± - Standard A</option>
    <option value="cmn-CN-Standard-B">ë‚¨ì„± - Standard B</option>
  </select><br><br>

  <button id="ttsBtn">TTS ìƒì„±</button>
  <a id="downloadLink" style="display:none;">MP3 ë‹¤ìš´ë¡œë“œ</a>

  <script>
    const ttsBtn = document.getElementById("ttsBtn");
    const downloadLink = document.getElementById("downloadLink");
    const speedInput = document.getElementById("speed");
    const speedVal = document.getElementById("speedVal");

    // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ
    speedInput.oninput = () => {
      speedVal.textContent = speedInput.value;
    };

    ttsBtn.onclick = async () => {
      const text = document.getElementById("text").value;
      const speed = parseFloat(speedInput.value);
      const voiceName = document.getElementById("voice").value;

      // ğŸ”‘ Google Cloud API í‚¤ ë„£ê¸°
      const apiKey = "AIzaSyB75eePCH1FTX3jXLA2mfk0EwoV_uf-Yxg";

      const response = await fetch(
        `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            input: { text: text },
            voice: {
              languageCode: "cmn-CN",   // ì¤‘êµ­ì–´ í‘œì¤€ì–´
              name: voiceName           // ì„ íƒí•œ ëª©ì†Œë¦¬
            },
            audioConfig: {
              audioEncoding: "MP3",
              speakingRate: speed       // ì†ë„ ì¡°ì ˆ
            }
          })
        }
      );

      const data = await response.json();

      if (data.audioContent) {
        // Base64 â†’ Blob ë³€í™˜
        const byteString = atob(data.audioContent);
        const byteArray = new Uint8Array(byteString.length);
        for (let i = 0; i < byteString.length; i++) {
          byteArray[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([byteArray], { type: "audio/mp3" });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.download = "tts.mp3";
        downloadLink.style.display = "block";
        downloadLink.textContent = "MP3 ë‹¤ìš´ë¡œë“œ";
      } else {
        alert("TTS ìƒì„± ì‹¤íŒ¨: " + JSON.stringify(data));
      }
    };
  </script>
</body>
</html>
