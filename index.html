<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Google Cloud TTS (중국어 → MP3)</title>
</head>
<body>
  <h2>중국어 TTS → MP3 다운로드</h2>

  <textarea id="text" rows="3" cols="40">公司同事中, 周围去外国留学的同事多吗？</textarea><br><br>

  <!-- 속도 조절 -->
  <label for="speed">속도: </label>
  <input type="range" id="speed" min="0.5" max="2.0" step="0.1" value="1">
  <span id="speedVal">1.0</span><br><br>

  <!-- 목소리 선택 -->
  <label for="voice">목소리 선택: </label>
  <select id="voice">
    <option value="cmn-CN-Wavenet-A">여성 - Wavenet A</option>
    <option value="cmn-CN-Wavenet-B">남성 - Wavenet B</option>
    <option value="cmn-CN-Wavenet-C">여성 - Wavenet C</option>
    <option value="cmn-CN-Wavenet-D">남성 - Wavenet D</option>
    <option value="cmn-CN-Standard-A">여성 - Standard A</option>
    <option value="cmn-CN-Standard-B">남성 - Standard B</option>
  </select><br><br>

  <button id="ttsBtn">TTS 생성</button>
  <a id="downloadLink" style="display:none;">MP3 다운로드</a>

  <script>
    const ttsBtn = document.getElementById("ttsBtn");
    const downloadLink = document.getElementById("downloadLink");
    const speedInput = document.getElementById("speed");
    const speedVal = document.getElementById("speedVal");

    // 슬라이더 값 표시
    speedInput.oninput = () => {
      speedVal.textContent = speedInput.value;
    };

    ttsBtn.onclick = async () => {
      const text = document.getElementById("text").value;
      const speed = parseFloat(speedInput.value);
      const voiceName = document.getElementById("voice").value;

      // 🔑 Google Cloud API 키 넣기
      const apiKey = "AIzaSyB75eePCH1FTX3jXLA2mfk0EwoV_uf-Yxg";

      const response = await fetch(
        `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            input: { text: text },
            voice: {
              languageCode: "cmn-CN",   // 중국어 표준어
              name: voiceName           // 선택한 목소리
            },
            audioConfig: {
              audioEncoding: "MP3",
              speakingRate: speed       // 속도 조절
            }
          })
        }
      );

      const data = await response.json();

      if (data.audioContent) {
        // Base64 → Blob 변환
        const byteString = atob(data.audioContent);
        const byteArray = new Uint8Array(byteString.length);
        for (let i = 0; i < byteString.length; i++) {
          byteArray[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([byteArray], { type: "audio/mp3" });
        const url = URL.createObjectURL(blob);

        downloadLink.href = url;
        downloadLink.download = "tts.mp3";
        downloadLink.style.display = "block";
        downloadLink.textContent = "MP3 다운로드";
      } else {
        alert("TTS 생성 실패: " + JSON.stringify(data));
      }
    };
  </script>
</body>
</html>
