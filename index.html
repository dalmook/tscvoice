<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Google Cloud TTS (ì¤‘êµ­ì–´ â†’ MP3)</title>
</head>
<body>
  <h2>ì¤‘êµ­ì–´ TTS â†’ MP3 ë‹¤ìš´ë¡œë“œ</h2>
  <textarea id="text" rows="3" cols="40">å…¬å¸åŒäº‹ä¸­, å‘¨å›´å»å¤–å›½ç•™å­¦çš„åŒäº‹å¤šå—ï¼Ÿ</textarea><br><br>

  <button id="ttsBtn">TTS ìƒì„±</button>
  <a id="downloadLink" style="display:none;">MP3 ë‹¤ìš´ë¡œë“œ</a>

  <script>
    const ttsBtn = document.getElementById("ttsBtn");
    const downloadLink = document.getElementById("downloadLink");

    ttsBtn.onclick = async () => {
      const text = document.getElementById("text").value;

      // ğŸ”‘ ì—¬ê¸° API í‚¤ë¥¼ ë„£ìœ¼ì„¸ìš”
      const apiKey = "AIzaSyB75eePCH1FTX3jXLA2mfk0EwoV_uf-Yxg";

      const response = await fetch(
        `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            input: { text: text },
            voice: {
              languageCode: "zh-CN",
              name: "zh-CN-Wavenet-A"  // Google ì¤‘êµ­ì–´ ì—¬ì„± ëª©ì†Œë¦¬
            },
            audioConfig: { audioEncoding: "MP3" }
          })
        }
      );

      const data = await response.json();

      if (data.audioContent) {
        // Base64 â†’ Blob ë³€í™˜
        const byteString = atob(data.audioContent);
        const byteArray = new Uint8Array(byteString.length);
        for (let i = 0; i < byteString.length; i++) {
          byteArray[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([byteArray], { type: "audio/mp3" });
        const url = URL.createObjectURL(blob);

        // ë‹¤ìš´ë¡œë“œ ë§í¬ í‘œì‹œ
        downloadLink.href = url;
        downloadLink.download = "tts.mp3";
        downloadLink.style.display = "block";
        downloadLink.textContent = "MP3 ë‹¤ìš´ë¡œë“œ";
      } else {
        alert("TTS ìƒì„± ì‹¤íŒ¨: " + JSON.stringify(data));
      }
    };
  </script>
</body>
</html>
