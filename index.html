<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Google Cloud TTS (중국어 → MP3)</title>
</head>
<body>
  <h2>중국어 TTS → MP3 다운로드</h2>
  <textarea id="text" rows="3" cols="40">公司同事中, 周围去外国留学的同事多吗？</textarea><br><br>

  <button id="ttsBtn">TTS 생성</button>
  <a id="downloadLink" style="display:none;">MP3 다운로드</a>

  <script>
    const ttsBtn = document.getElementById("ttsBtn");
    const downloadLink = document.getElementById("downloadLink");

    ttsBtn.onclick = async () => {
      const text = document.getElementById("text").value;

      // 🔑 여기 API 키를 넣으세요
      const apiKey = "AIzaSyB75eePCH1FTX3jXLA2mfk0EwoV_uf-Yxg";

      const response = await fetch(
        `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            input: { text: text },
            voice: {
              languageCode: "zh-CN",
              name: "zh-CN-Wavenet-A"  // Google 중국어 여성 목소리
            },
            audioConfig: { audioEncoding: "MP3" }
          })
        }
      );

      const data = await response.json();

      if (data.audioContent) {
        // Base64 → Blob 변환
        const byteString = atob(data.audioContent);
        const byteArray = new Uint8Array(byteString.length);
        for (let i = 0; i < byteString.length; i++) {
          byteArray[i] = byteString.charCodeAt(i);
        }
        const blob = new Blob([byteArray], { type: "audio/mp3" });
        const url = URL.createObjectURL(blob);

        // 다운로드 링크 표시
        downloadLink.href = url;
        downloadLink.download = "tts.mp3";
        downloadLink.style.display = "block";
        downloadLink.textContent = "MP3 다운로드";
      } else {
        alert("TTS 생성 실패: " + JSON.stringify(data));
      }
    };
  </script>
</body>
</html>
